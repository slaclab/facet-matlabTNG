<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>F2_GunE</title>
  </head>
  <body>
    <h1>FACET-II Gun: Larmor Angle Measurement of Energy</h1>
    <h2>Author</h2>
    <p>G. White, SLAC.<br>
      email: whitegr -AT- slac.stanford.edu <br>
    </p>
    <p><b>Release Status: <font color="#ff0000">V1.0</font></b> </p>
    <h2>Source</h2>
    <ul>
      <li><a href="F2_LAME.mlapp">Matlab app</a></li>
      <li>Standalone</li>
      <ul>
        <li><a href="F2_LAME.exe">Windows</a></li>
        <li><a href="F2_LAME.zip">Mac</a></li>
        <li><a href="F2_LAME.install">Linux</a> (RHEL6 compiled)</li>
      </ul>
    </ul>
    <h2>GUI</h2>
    <img src="F2_LAME_app.jpg" alt="App image" width="517" height="313">
    <p>Install Matlab app (built with R2018b) or standalone binary file
      in chosen OS to use bundled GUI, or use functional form from
      within Matlab.<br>
      A Lookup table was calculated using a 3D tracking model of the
      FACET-II injector using the code GPT, including a measured 3D
      field map of the gun solenoid magnet. The change in horizontal and
      vertical position of a test particle at the screen PR10241 for a
      1A change in XC10121 or YC10122 was calculated for solenoid
      currents between 90-170A and gun energies up to 7 MeV is stored in
      the lookup table. The two parameters R and Theta are stored in
      each case, corresponding to sqrt(dx^2+dy^2) and atan(dy/dx). The
      app looks up the gun energy corresponding to the same parameters
      provided by measurements on the FACET-II gun.<br>
    </p>
    <p><b>Measurement Process:</b><br>
    </p>
    <ul>
      <li>Enter solenoid current used (90-170A)<br>
      </li>
      <li>Measure x &amp; y beam centroid position on PR10241</li>
      <li>Change XC10121 or YC10122 corrector strength</li>
      <li>Re-measure beam centroid positions</li>
      <li>Enter change in positions (dx &amp; dy) and change in
        corrector setting used, or linear fit changes across a range of
        settings.<br>
      </li>
    </ul>
    <p><b>Fit results:</b><br>
    </p>
    <ul>
      <li>App generates 2 lookup parameters based on input data: R and
        Theta, the vector length and angle calculated from the dx/dy
        screen position shifts entered. The R parameter is normalized by
        the corrector current and shown as R/I in the plot.</li>
      <li>You can also constrain the range of the energy fit by checking
        the "Enable" box in the corresponding panel and providing upper
        and lower gun energy bounds</li>
      <ul>
        <li>For certain combinations of the R/Theta parameters the
          corresponding energy of the Gun has 2 possible values, using
          the Constrain fit options allows the choice of the fitter to
          be guided<br>
        </li>
      </ul>
    </ul>
    <p>3 calculated Gun energy measurements are shown:<br>
    </p>
    <ul>
      <li>"Closest fit": closest point in lookup table based on R and
        Theta measurements</li>
      <li>"From R": energy which fits R measurement value</li>
      <li>"From Theta": energy which fits Theta measurement value<br>
      </li>
    </ul>
    <p><b>Functional interface:<br>
      </b></p>
    <p>After installing the Matlab app above, the functional interface
      for the fitting algorithm can be used from a Matlab command
      window:<br>
    </p>
    <pre>&gt;&gt; FD = F2GunDiagnostics ;<br>&gt;&gt; [Efit1,Efit2,Efit3] = Ecalc(FD,dx,dy,dcorI,solI,dir,emin,emax) ;<br>&gt;&gt; help Ecalc<br>--- help for F2GunDiagnostics/Ecalc ---<br><br> Ecalc Calculate gun energy based on x and y screen position changes for given corrector strength change and solenoid strength<br> [Efit1,Efit2,Efit3] = Ecalc(dx,dy,dcorI,solI,dir [,emin,emax])<br>  dx / dy [mm]:   Change in horizontal and vertical beam position on PR10241<br>  dcorI [A]: Change in Gun corrector current used (XC10121 or YC10122)<br>  solI [A]: Solenoid current used<br>  dir: 'x' for XC10121 and 'y' for YC10122<br>  emin (optional): lower bound on energy to fit<br>  emax (optional): upper bound on energy to fit<br> <br>  Efit1 [MeV]: Gun energy using closest fit to calibration curve using both "R" and "Theta" data<br>  Efit2 [MeV]: Gun energy using fit biased by "R" data<br>  Efit3 [MeV]: Gun energy using fit biased by "Theta" data<br></pre>
    <br>
    <p><br>
    </p>
  </body>
</html>
